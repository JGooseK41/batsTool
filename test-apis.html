<!DOCTYPE html>
<html>
<head>
    <title>B.A.T.S. API Test Suite</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 20px;
            max-width: 1400px;
        }
        h1 { color: #00ff00; }
        h2 { color: #ffff00; margin-top: 30px; }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-card {
            background: #2a2a2a;
            border: 1px solid #00ff00;
            padding: 15px;
            border-radius: 5px;
        }
        .test-card h3 {
            color: #00ffff;
            margin-top: 0;
        }
        .status {
            padding: 5px 10px;
            margin: 5px 0;
            border-radius: 3px;
        }
        .success { background: #004400; color: #00ff00; }
        .error { background: #440000; color: #ff0000; }
        .pending { background: #444400; color: #ffff00; }
        .info { background: #004444; color: #00ffff; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 3px;
        }
        button:hover { background: #00cc00; }
        input {
            background: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px;
            margin: 5px;
            width: 300px;
        }
        pre {
            background: #111;
            padding: 10px;
            overflow-x: auto;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .api-list {
            display: grid;
            gap: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ü¶á B.A.T.S. API Integration Test Suite</h1>
    <p>Test all API endpoints to verify connectivity and functionality</p>

    <div class="test-card" style="background: #003300; border-color: #00ff00; margin: 20px 0;">
        <h3>üìù API Notes & Best Practices</h3>
        <ul style="color: #00ff00; line-height: 1.6;">
            <li><strong>Mempool.space</strong>: Best UI autocomplete on their website, API has backend support for prefix search but endpoint not fully documented</li>
            <li><strong>Arkham Intelligence</strong>: Best for Bitcoin address attribution and entity identification</li>
            <li><strong>Blockchain.info</strong>: Good for complete addresses and transaction data</li>
            <li><strong>Address Search Strategy</strong>: We try multiple APIs in order - Mempool (experimental) ‚Üí Arkham (attribution) ‚Üí Complete address lookups ‚Üí Known databases</li>
        </ul>
    </div>

    <h2>Available APIs</h2>
    <div class="test-grid">
        <div class="test-card">
            <h3>‚úÖ FREE APIs (No Auth)</h3>
            <div class="api-list">
                <div class="status info">üì° Blockchain.info - Bitcoin data</div>
                <div class="status info">üì° Mempool.space - Bitcoin mempool & blocks</div>
                <div class="status info">üì° BlockCypher - Multi-chain (limited free tier)</div>
            </div>
        </div>

        <div class="test-card">
            <h3>üîë API Key Required</h3>
            <div class="api-list">
                <div class="status pending">üîê Etherscan - Ethereum & EVM chains</div>
                <div class="status pending">üîê Arkham Intelligence - Entity attribution</div>
                <div class="status pending">üîê TronGrid - Tron blockchain</div>
            </div>
        </div>
    </div>

    <h2>Quick API Tests</h2>

    <div class="test-grid">
        <!-- Bitcoin Tests -->
        <div class="test-card">
            <h3>Bitcoin Transaction Lookup</h3>
            <input type="text" id="btcTxHash" placeholder="Bitcoin transaction hash" value="4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b">
            <button onclick="testBitcoinTx()">Test Bitcoin APIs</button>
            <div id="btcResults"></div>
        </div>

        <!-- Address Search Test -->
        <div class="test-card">
            <h3>Address Search (Partial)</h3>
            <input type="text" id="partialAddress" placeholder="Partial address (min 3 chars)" value="1A1zP1">
            <button onclick="testAddressSearch()">Search Addresses</button>
            <div id="searchResults"></div>
        </div>

        <!-- Mempool.space Test -->
        <div class="test-card">
            <h3>Mempool.space API (FREE)</h3>
            <button onclick="testMempoolAPI()">Test Mempool.space</button>
            <div id="mempoolResults"></div>
        </div>

        <!-- Etherscan Test -->
        <div class="test-card">
            <h3>Etherscan API Test</h3>
            <input type="text" id="ethTxHash" placeholder="Ethereum transaction hash" value="0x5c504ed432cb51138bcf09aa5e8a410dd4a1e204ef84bfed1be16dfba1b22060">
            <button onclick="testEtherscanAPI()">Test Etherscan</button>
            <div id="etherscanResults"></div>
        </div>
    </div>

    <h2>API Response Logs</h2>
    <pre id="apiLogs">API test results will appear here...</pre>

    <script>
        function log(message, type = 'info') {
            const logs = document.getElementById('apiLogs');
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            const typeEmoji = {
                'success': '‚úÖ',
                'error': '‚ùå',
                'info': '‚ÑπÔ∏è',
                'warning': '‚ö†Ô∏è'
            };
            logs.textContent += `[${timestamp}] ${typeEmoji[type] || ''} ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
        }

        async function testBitcoinTx() {
            const txHash = document.getElementById('btcTxHash').value;
            const resultsDiv = document.getElementById('btcResults');
            resultsDiv.innerHTML = '<div class="status pending">Testing APIs...</div>';

            const apis = [
                {
                    name: 'Blockchain.info',
                    url: `https://blockchain.info/rawtx/${txHash}`,
                    free: true
                },
                {
                    name: 'Mempool.space',
                    url: `https://mempool.space/api/tx/${txHash}`,
                    free: true
                },
                {
                    name: 'BlockCypher',
                    url: `https://api.blockcypher.com/v1/btc/main/txs/${txHash}`,
                    free: true
                }
            ];

            let results = '';
            for (const api of apis) {
                try {
                    log(`Testing ${api.name}...`);
                    const response = await fetch(api.url);
                    if (response.ok) {
                        const data = await response.json();
                        results += `<div class="status success">${api.name}: ‚úÖ Working${api.free ? ' (FREE)' : ''}</div>`;
                        log(`${api.name} responded successfully`, 'success');
                    } else {
                        results += `<div class="status error">${api.name}: ‚ùå ${response.status}</div>`;
                        log(`${api.name} failed: ${response.status}`, 'error');
                    }
                } catch (e) {
                    results += `<div class="status error">${api.name}: ‚ùå ${e.message}</div>`;
                    log(`${api.name} error: ${e.message}`, 'error');
                }
            }
            resultsDiv.innerHTML = results;
        }

        async function testAddressSearch() {
            const pattern = document.getElementById('partialAddress').value;
            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '<div class="status pending">Searching...</div>';

            try {
                // For this test, we'll check if we can find addresses
                log(`Searching for addresses starting with: ${pattern}`);

                // Test Arkham if available
                const arkhamKey = localStorage.getItem('bats_arkham_api_key');
                if (arkhamKey) {
                    try {
                        const arkhamUrl = `https://api.arkhamintelligence.com/addresses/search?q=${pattern}&chains=bitcoin`;
                        const response = await fetch(arkhamUrl, {
                            headers: { 'API-Key': arkhamKey }
                        });
                        if (response.ok) {
                            const data = await response.json();
                            resultsDiv.innerHTML = `<div class="status success">Arkham: Found ${data.addresses?.length || 0} addresses</div>`;
                            log(`Arkham Intelligence found ${data.addresses?.length || 0} matches`, 'success');
                        }
                    } catch (e) {
                        log(`Arkham search failed: ${e.message}`, 'error');
                    }
                } else {
                    resultsDiv.innerHTML = '<div class="status info">Note: Arkham API key not configured</div>';
                }

                // For known addresses, we can do local matching
                if (pattern === '1A1zP1') {
                    resultsDiv.innerHTML += '<div class="status success">Match: Genesis Block (1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa)</div>';
                    log('Found Genesis Block address!', 'success');
                }

            } catch (e) {
                resultsDiv.innerHTML = `<div class="status error">Search error: ${e.message}</div>`;
                log(`Address search error: ${e.message}`, 'error');
            }
        }

        async function testMempoolAPI() {
            const resultsDiv = document.getElementById('mempoolResults');
            resultsDiv.innerHTML = '<div class="status pending">Testing Mempool.space...</div>';

            const tests = [
                {
                    name: 'Latest Block',
                    url: 'https://mempool.space/api/blocks/tip/height'
                },
                {
                    name: 'Fee Estimates',
                    url: 'https://mempool.space/api/v1/fees/recommended'
                },
                {
                    name: 'Address Info',
                    url: 'https://mempool.space/api/address/1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa'
                }
            ];

            let results = '';
            for (const test of tests) {
                try {
                    log(`Testing Mempool.space ${test.name}...`);
                    const response = await fetch(test.url);
                    if (response.ok) {
                        const data = await response.text();
                        results += `<div class="status success">${test.name}: ‚úÖ Working</div>`;
                        log(`Mempool.space ${test.name} working`, 'success');
                    } else {
                        results += `<div class="status error">${test.name}: ‚ùå ${response.status}</div>`;
                        log(`Mempool.space ${test.name} failed: ${response.status}`, 'error');
                    }
                } catch (e) {
                    results += `<div class="status error">${test.name}: ‚ùå ${e.message}</div>`;
                    log(`Mempool.space ${test.name} error: ${e.message}`, 'error');
                }
            }
            resultsDiv.innerHTML = results;
        }

        async function testEtherscanAPI() {
            const txHash = document.getElementById('ethTxHash').value;
            const resultsDiv = document.getElementById('etherscanResults');
            resultsDiv.innerHTML = '<div class="status pending">Testing Etherscan...</div>';

            const apiKey = localStorage.getItem('bats_etherscan_api_key') || '3X65ZBIMYIGFZEV6B3D2YWWXUJD1DWAKP8';

            try {
                log('Testing Etherscan API...');
                const url = `https://api.etherscan.io/v2/api?chainid=1&module=proxy&action=eth_getTransactionByHash&txhash=${txHash}&apikey=${apiKey}`;
                const response = await fetch(url);

                if (response.ok) {
                    const data = await response.json();
                    if (data.result) {
                        resultsDiv.innerHTML = '<div class="status success">Etherscan: ‚úÖ API Working</div>';
                        log('Etherscan API working successfully', 'success');
                    } else {
                        resultsDiv.innerHTML = '<div class="status error">Etherscan: Invalid response</div>';
                        log('Etherscan returned invalid data', 'error');
                    }
                } else {
                    resultsDiv.innerHTML = `<div class="status error">Etherscan: ‚ùå ${response.status}</div>`;
                    log(`Etherscan failed: ${response.status}`, 'error');
                }
            } catch (e) {
                resultsDiv.innerHTML = `<div class="status error">Etherscan: ‚ùå ${e.message}</div>`;
                log(`Etherscan error: ${e.message}`, 'error');
            }
        }

        // Initial log
        log('B.A.T.S. API Test Suite initialized', 'success');
        log('Mempool.space API is FREE and requires NO authentication!', 'info');
    </script>
</body>
</html>