<!DOCTYPE html>
<html>
<head>
    <title>Test Attribution APIs</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { border-left: 4px solid green; }
        .error { border-left: 4px solid red; }
        button { padding: 10px 20px; margin: 10px; cursor: pointer; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>Test Attribution APIs</h1>

    <div>
        <label>Test Address: </label>
        <input type="text" id="testAddress" value="DsyQiQneNnfE3BprqsvACA8HhNhreRbbTfLrqewTkcmv" style="width: 500px;">
        <button onclick="testAll()">Test All APIs</button>
    </div>

    <div id="results"></div>

    <script>
        async function testArkham(address) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += '<h2>Testing Arkham API...</h2>';

            const endpoints = [
                { name: 'Basic', path: `/intelligence/address/${address}` },
                { name: 'All Chains', path: `/intelligence/address/${address}/all` },
                { name: 'Enhanced', path: `/intelligence/address_with_extra_enrichment/${address}/all` }
            ];

            for (const endpoint of endpoints) {
                try {
                    console.log(`Testing Arkham ${endpoint.name}: ${endpoint.path}`);

                    const response = await fetch(`/.netlify/functions/arkham3?endpoint=${encodeURIComponent(endpoint.path)}`, {
                        headers: {
                            'X-Arkham-API-Key': 'd377a526-c9ea-4cb6-a647-775559583ff6'
                        }
                    });

                    const data = await response.json();

                    const hasAttribution = data && (
                        data.arkhamEntity ||
                        data.entity ||
                        data.entities ||
                        data.labels ||
                        data.label ||
                        data.name
                    );

                    resultsDiv.innerHTML += `
                        <div class="result ${hasAttribution ? 'success' : ''}">
                            <strong>Arkham ${endpoint.name}:</strong> Status ${response.status}<br>
                            ${hasAttribution ? '<span style="color: green;">✅ ATTRIBUTION FOUND!</span><br>' : '<span style="color: orange;">⚠️ No attribution</span><br>'}
                            <details>
                                <summary>View Response</summary>
                                <pre>${JSON.stringify(data, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } catch (error) {
                    resultsDiv.innerHTML += `
                        <div class="result error">
                            <strong>Arkham ${endpoint.name}:</strong> Error - ${error.message}
                        </div>
                    `;
                }
            }
        }

        async function testSolscan(address) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML += '<h2>Testing Solscan API...</h2>';

            try {
                const apiKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjcmVhdGVkQXQiOjE3NTg4OTk1ODMyNTksImVtYWlsIjoiamVzc2VAdGhlYmxvY2thdWRpdC5jb20iLCJhY3Rpb24iOiJ0b2tlbi1hcGkiLCJhcGlWZXJzaW9uIjoidjIiLCJpYXQiOjE3NTg4OTk1ODN9.C3By0UPXwI5bmLrAl9o1U_SDnT7uQLoizbd8qr36GmQ';

                console.log(`Testing Solscan for ${address}`);

                const response = await fetch(`/.netlify/functions/solscan-proxy?address=${address}&apiKey=${encodeURIComponent(apiKey)}`);
                const data = await response.json();

                const hasAttribution = data?.success && data?.data && (
                    data.data.account_label ||
                    data.data.account_tags?.length > 0
                );

                resultsDiv.innerHTML += `
                    <div class="result ${hasAttribution ? 'success' : ''}">
                        <strong>Solscan Pro API:</strong> Status ${response.status}<br>
                        ${hasAttribution ? `<span style="color: green;">✅ ATTRIBUTION FOUND: ${data.data.account_label || data.data.account_tags?.[0]}</span><br>` : '<span style="color: orange;">⚠️ No attribution</span><br>'}
                        <details>
                            <summary>View Response</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="result error">
                        <strong>Solscan:</strong> Error - ${error.message}
                    </div>
                `;
            }
        }

        async function testAll() {
            const address = document.getElementById('testAddress').value;
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `<h2>Testing address: ${address}</h2>`;

            await testArkham(address);
            await testSolscan(address);

            resultsDiv.innerHTML += '<hr><p>Check the browser console for detailed logs.</p>';
        }

        // Test on load
        window.onload = () => {
            console.log('Test page loaded. Click "Test All APIs" to begin.');
        };
    </script>
</body>
</html>