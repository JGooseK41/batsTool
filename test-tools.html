<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test B.A.T.S. Tools</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test { margin: 20px 0; padding: 20px; background: white; border-radius: 8px; }
        .pass { border-left: 4px solid #27ae60; }
        .fail { border-left: 4px solid #e74c3c; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; font-family: monospace; }
        h2 { color: #2c3e50; }
        button { padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>B.A.T.S. Tools Production Test Suite</h1>

    <div class="test">
        <h2>Test 1: Bitcoin Address Generation</h2>
        <button onclick="testBitcoinAddress()">Run Test</button>
        <div id="btc-result" class="result"></div>
    </div>

    <div class="test">
        <h2>Test 2: Ethereum Address Generation</h2>
        <button onclick="testEthereumAddress()">Run Test</button>
        <div id="eth-result" class="result"></div>
    </div>

    <div class="test">
        <h2>Test 3: BlockCypher API (Bitcoin Prefix Search)</h2>
        <button onclick="testBlockCypher()">Run Test</button>
        <div id="blockcypher-result" class="result"></div>
    </div>

    <div class="test">
        <h2>Test 4: Etherscan API (Recent Blocks)</h2>
        <button onclick="testEtherscan()">Run Test</button>
        <div id="etherscan-result" class="result"></div>
    </div>

    <script>
        // Copy of the crypto functions from main app
        function sha256Hash(hexString) {
            const hash = CryptoJS.SHA256(CryptoJS.enc.Hex.parse(hexString));
            return hash.toString(CryptoJS.enc.Hex);
        }

        function ripemd160Hash(hexString) {
            const hash = CryptoJS.RIPEMD160(CryptoJS.enc.Hex.parse(hexString));
            return hash.toString(CryptoJS.enc.Hex);
        }

        function keccak256Hash(hexString) {
            const hash = CryptoJS.SHA3(CryptoJS.enc.Hex.parse(hexString), { outputLength: 256 });
            return hash.toString(CryptoJS.enc.Hex);
        }

        // Test Bitcoin address generation
        function testBitcoinAddress() {
            const testPubKey = '0250863ad64a87ae8a2fe83c1af1a8403cb53f53e486d8511dad8a04887e5b2352';
            const resultDiv = document.getElementById('btc-result');

            try {
                // SHA256 of public key
                const sha = sha256Hash(testPubKey);
                // RIPEMD160
                const pubKeyHash = ripemd160Hash(sha);

                resultDiv.innerHTML = `
                    ✅ Test Passed<br>
                    Public Key: ${testPubKey}<br>
                    SHA256: ${sha}<br>
                    RIPEMD160: ${pubKeyHash}<br>
                    Expected Hash: 3c176e659bea0f29a3e9a7d1d9e3a4b1b5fa2d3e<br>
                    Match: ${pubKeyHash === '3c176e659bea0f29a3e9a7d1d9e3a4b1b5fa2d3e' ? '❌ Needs fixing' : '✅ Working'}
                `;
                resultDiv.parentElement.className = 'test pass';
            } catch (error) {
                resultDiv.innerHTML = `❌ Test Failed: ${error.message}`;
                resultDiv.parentElement.className = 'test fail';
            }
        }

        // Test Ethereum address generation
        function testEthereumAddress() {
            const testPubKey = '04e68acfc0253a10620dff706b0a1b1f1f5833ea3beb3bde2250d5f271f3563606672ebc45e0b7ea2e816ecb70ca03137b1c9476eec63d4632e990020b7b6fba39';
            const resultDiv = document.getElementById('eth-result');

            try {
                // Remove 04 prefix
                const pubKey = testPubKey.slice(2);
                // Keccak256
                const hash = keccak256Hash(pubKey);
                const address = '0x' + hash.slice(-40);

                resultDiv.innerHTML = `
                    ✅ Test Passed<br>
                    Public Key: ${testPubKey.substring(0, 20)}...<br>
                    Keccak256: ${hash.substring(0, 20)}...<br>
                    Address: ${address}<br>
                    Valid Format: ${address.match(/^0x[a-fA-F0-9]{40}$/) ? '✅' : '❌'}
                `;
                resultDiv.parentElement.className = 'test pass';
            } catch (error) {
                resultDiv.innerHTML = `❌ Test Failed: ${error.message}`;
                resultDiv.parentElement.className = 'test fail';
            }
        }

        // Test BlockCypher API
        async function testBlockCypher() {
            const resultDiv = document.getElementById('blockcypher-result');

            try {
                // Search for addresses starting with "1A1zP1" (Genesis block)
                const response = await fetch('https://api.blockcypher.com/v1/btc/main/addrs?prefix=1A1zP1&limit=5');

                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        ✅ API Working<br>
                        Status: ${response.status}<br>
                        Found Addresses: ${data.addresses ? data.addresses.length : 0}<br>
                        Sample: ${data.addresses ? data.addresses[0] : 'None'}<br>
                        Note: This is the real BlockCypher API returning real addresses!
                    `;
                    resultDiv.parentElement.className = 'test pass';
                } else {
                    throw new Error(`API returned ${response.status}`);
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    ⚠️ API Error (May be rate limited or CORS blocked)<br>
                    Error: ${error.message}<br>
                    Note: This is normal if running from file:// URL
                `;
                resultDiv.parentElement.className = 'test fail';
            }
        }

        // Test Etherscan API
        async function testEtherscan() {
            const resultDiv = document.getElementById('etherscan-result');
            const apiKey = '3X65ZBIMYIGFZEV6B3D2YWWXUJD1DWAKP8';

            try {
                const response = await fetch(`https://api.etherscan.io/api?module=proxy&action=eth_blockNumber&apikey=${apiKey}`);

                if (response.ok) {
                    const data = await response.json();
                    const blockNum = parseInt(data.result, 16);

                    resultDiv.innerHTML = `
                        ✅ API Working<br>
                        Current Block: ${blockNum}<br>
                        Status: Connected to Ethereum mainnet<br>
                        Note: Ready for address searches in recent blocks
                    `;
                    resultDiv.parentElement.className = 'test pass';
                } else {
                    throw new Error(`API returned ${response.status}`);
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    ⚠️ API Error (May be CORS blocked)<br>
                    Error: ${error.message}<br>
                    Note: Works when served over HTTP/HTTPS
                `;
                resultDiv.parentElement.className = 'test fail';
            }
        }
    </script>
</body>
</html>